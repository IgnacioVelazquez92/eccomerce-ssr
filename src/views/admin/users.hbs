{{!-- views/admin/users.hbs --}}
{{#> layouts/main title="Usuarios" }}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">Usuarios</h4>
        {{!-- Form crear usuario rápido --}}
        <form class="d-flex gap-2" method="POST" action="/admin/users">
            <input type="text" class="form-control form-control-sm" name="name" placeholder="Nombre" required>
            <input type="email" class="form-control form-control-sm" name="email" placeholder="email@dominio.com"
                required>
            <input type="password" class="form-control form-control-sm" name="password" placeholder="Contraseña"
                required>
            <select class="form-select form-select-sm" name="role" style="max-width:150px">
                {{#each roles}}
                <option value="{{this}}">{{this}}</option>
                {{/each}}
            </select>
            <button class="btn btn-sm btn-success">Crear</button>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th>Activo</th>
                    <th>Creado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {{#each users}}
                <tr>
                    <td>{{this.name}}</td>
                    <td>{{this.email}}</td>
                    <td>
                        <form class="d-flex gap-2" method="POST" action="/admin/users/{{this.id}}/update">
                            <input type="hidden" name="name" value="{{this.name}}">
                            <select class="form-select form-select-sm" name="role" style="max-width:150px">
                                <option value="user" {{#if (eq this.role "user" )}}selected{{/if}}>user</option>
                                <option value="admin" {{#if (eq this.role "admin" )}}selected{{/if}}>admin</option>
                            </select>
                            <button class="btn btn-sm btn-outline-primary">Guardar</button>
                        </form>
                    </td>
                    <td>
                        <span class="badge {{#if this.active}}text-bg-success{{else}}text-bg-secondary{{/if}}">
                            {{#if this.active}}Sí{{else}}No{{/if}}
                        </span>
                    </td>
                    <td>{{this.createdAt}}</td>
                    <td class="text-end">
                        <form method="POST" action="/admin/users/{{this.id}}/toggle" class="d-inline">
                            <button
                                class="btn btn-sm {{#if this.active}}btn-outline-warning{{else}}btn-outline-success{{/if}}">
                                {{#if this.active}}Desactivar{{else}}Activar{{/if}}
                            </button>
                        </form>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>

{{/layouts/main}}